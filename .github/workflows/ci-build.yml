name: CI Build on rename2

on:
  push:
    branches:
      - rename2
  pull_request:
    branches:
      - rename2

permissions:
  contents: read

jobs:
  build:
    runs-on: ubuntu-22.04
    timeout-minutes: 60

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential libtool autotools-dev automake pkg-config bsdmainutils python3
        sudo apt-get install -y libssl-dev libevent-dev libboost-system-dev libboost-filesystem-dev libboost-chrono-dev \
          libboost-test-dev libboost-thread-dev libminiupnpc-dev libzmq3-dev libqt5gui5 libqt5core5a libqt5dbus5 \
          qttools5-dev qttools5-dev-tools libprotobuf-dev protobuf-compiler libqrencode-dev

    - name: Build
      run: |
        ./autogen.sh
        ./configure --disable-wallet --without-gui --disable-tests --disable-bench
        make -j$(nproc)

    - name: Run basic tests
      run: |
        ./src/test/test_dogecoin
        ./src/bench/bench_dogecoin --list | head -n 5

    - name: Verify binaries
      run: |
        file src/dogecoind
        file src/dogecoin-cli
        ./src/dogecoind --version
        ./src/dogecoin-cli --version
